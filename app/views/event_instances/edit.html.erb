  <%# <div data-controller="datepicker">
  <!-- Displaying validations for errors -->
  <% if @event_instance.errors.any? %>
<%# <div class="alert alert-danger">
    <h4>There are errors with your submission:</h4>
    <ul>
      <% @event_instance.errors.full_messages.each do |msg| %>
  <%# <li><%= msg</li>  %>
  <%# <% end %>
  <%# </ul> %>
  <%# </div> %>
  <%# <% end %>
  <div class="container d-flex justify-content-center mt-6 mb-6">
    <%= simple_form_for @event_instance, html: { multipart: true } do |f| %>
      <div>
        <!-- Nested form for the associated event -->
        <%= f.fields_for :event do |event_fields| %>
          <%= event_fields.input :title, label: "Event Title", input_html: { placeholder: "Event title (this will apply to all instances)" } %>
          <%= event_fields.input :description, label: "Description", input_html: { placeholder: "Description (this will apply to all instances)" } %>
          <!-- Hidden field for location, if needed later -->
          <%# <%= event_fields.input :location_id, as: :hidden %>
        <% end %>
      </div>
      <!-- Common fields for the event instance -->
      <div class="form-group">
        <%= f.input :capacity %>
      </div>
      <div class="form-group">
        <%= f.input :price %>
      </div>
      <!-- File upload fields -->
      <div class="form-group mb-8">
        <%= f.input :photos, as: :file, input_html: { multiple: true } %>
      </div>
      <div class="form-group mb-8">
        <%= f.input :videos, as: :file, input_html: { multiple: true } %>
      </div>
      <!-- Conditional fields for different event recurrence types -->
      <% if @event.recurrence_type == 'one-time' %>
        <!-- Single Event Fields (e.g., Date and Time) -->
        <%= f.hidden_field :start_time, id: "event_start_time" %>
        <%= f.hidden_field :start_date, id: "event_start_date" %>
        <p>
          <strong>Event Start Date:</strong>
          <%= @event_instance.start_time.in_time_zone('Asia/Tokyo').strftime('%B %d, %Y') %>
          <%= link_to 'Edit Date', '#', class: 'edit-date-btn' %>
        </p>
        <div id="edit-date-form" style="display:none;">
          <%= f.input :start_time, as: :date, label: "New Date", input_html: { data: { datepicker_target: "start", action: "change->datepicker#initFlatpickrSingle" } } %>
          <%= f.submit 'Save Date' %>
        </div>
        <p>
          <strong>Event Start Time:</strong>
          <%= @event_instance.start_time.in_time_zone('Asia/Tokyo').strftime('%H:%M') %>
          <%= link_to 'Edit Time', '#', class: 'edit-time-btn' %>
        </p>
        <div id="edit-time-form" style="display:none;">
          <%= f.input :start_time, as: :time, label: "New Time", input_html: { data: { datepicker_target: "start", action: "change->datepicker#initTimePicker" } } %>
          <%= f.submit 'Save Time' %>
        </div>
        <!-- JavaScript for showing and hiding the edit forms -->
        <script>
          document.addEventListener("DOMContentLoaded", function() {
            // Show or hide the edit date form
            document.querySelector(".edit-date-btn").addEventListener("click", function(event) {
              event.preventDefault();
              document.getElementById("edit-date-form").style.display = "block";
              document.getElementById("edit-time-form").style.display = "none"; // Hide time form
              initializeDatepicker(); // Initialize Flatpickr for the date input when the form is shown
            });

            // Show or hide the edit time form
            document.querySelector(".edit-time-btn").addEventListener("click", function(event) {
              event.preventDefault();
              document.getElementById("edit-time-form").style.display = "block";
              document.getElementById("edit-date-form").style.display = "none"; // Hide date form
              initializeTimepicker(); // Initialize Flatpickr for the time input when the form is shown
            });
          });

          // Function to initialize Flatpickr for the date input
          function initializeDatepicker() {
            const dateInput = document.querySelector("[data-datepicker-target='eventDate']");
            if (dateInput && !dateInput._flatpickr) { // Avoid initializing more than once
              flatpickr(dateInput, {
                dateFormat: "Y-m-d",
                minDate: "today", // Disable past dates
                onChange: function(selectedDates) {
                  const selectedDate = selectedDates[0] ? selectedDates[0].toISOString().split("T")[0] : "";
                  document.getElementById("event_start_date").value = selectedDate;  // Update hidden date field
                }
              });
            }
          }

          // Function to initialize Flatpickr for the time input
          function initializeTimepicker() {
            const timeInput = document.querySelector("[data-datepicker-target='eventTime']");
            if (timeInput && !timeInput._flatpickr) { // Avoid initializing more than once
              flatpickr(timeInput, {
                enableTime: true,
                noCalendar: true,
                dateFormat: "H:i",
                onChange: function(selectedDates) {
                  const selectedTime = selectedDates[0] ? selectedDates[0].toTimeString().split(" ")[0] : "";
                  document.getElementById("event_start_time").value = selectedTime;  // Update hidden time field
                }
              });
            }
          }
        </script>
      <% elsif @event.recurrence_type == 'every-week' %>
        <!-- Weekly Event Fields -->
        <div class="form-group">
          <%= f.input :start_date, as: :string, input_html: { data: { datepicker_target: "start", action: "change->datepicker#fetchStudios" } } %>
        </div>
        <div class="form-group">
          <%= f.input :end_date, as: :string, input_html: { data: { datepicker_target: "end", action: "change->datepicker#fetchStudios" } } %>
        </div>
      <% elsif @event.recurrence_type == 'custom-dates' %>
        <!-- Custom Event Fields -->
        <div class="form-group">
          <%= f.input :custom_start_date, as: :string, input_html: { data: { datepicker_target: "start", action: "change->datepicker#fetchStudios" } } %>
        </div>
        <div class="form-group">
          <%= f.input :custom_end_date, as: :string, input_html: { data: { datepicker_target: "end", action: "change->datepicker#fetchStudios" } } %>
        </div>
        <div class="form-group">
          <%= f.input :additional_notes, as: :text, label: "Additional Notes (for custom events)" %>
        </div>
      <% end %>
      <!-- Submit Button -->
      <%= f.submit "Save Changes", class: "btn btn-custom my-3 btn-right" %>
    <% end %>
  </div>
