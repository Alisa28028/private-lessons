<h1>Admin Dashboard</h1>
<h2>Analytics</h2>
<p>Total Visits: <%= @total_visits || 0 %></p>
<p>Total Events: <%= @total_events || 0 %></p>
<h3>Visits by Country</h3>
<% if @visits_by_country.present? %>
  <ul>
    <% @visits_by_country.each do |country, count| %>
      <li><%= country.presence || "Unknown" %>: <%= count %></li>
    <% end %>
  </ul>
<% else %>
  <p>No visits yet</p>
<% end %>
<h3>Visits by Region/State</h3>
<% if @visits_by_region.present? %>
  <ul>
    <% @visits_by_region.each do |region, count| %>
      <li><%= region.presence || "Unknown" %>: <%= count %></li>
    <% end %>
  </ul>
<% else %>
  <p>No visits yet</p>
<% end %>
<h3>Visits by City</h3>
<% if @visits_by_city.present? %>
  <ul>
    <% @visits_by_city.each do |city, count| %>
      <li><%= city.presence || "Unknown" %>: <%= count %></li>
    <% end %>
  </ul>
<% else %>
  <p>No visits yet</p>
<% end %>
<h2>Users</h2>
<p>Total Users: <%= @total_users || 0 %></p>
<h3>Recent Users</h3>
<% if @recent_users.present? %>
  <ul>
    <% @recent_users.each do |user| %>
      <li><%= user.email %> — <%= user.created_at.strftime("%Y-%m-%d") %></li>
    <% end %>
  </ul>
<% else %>
  <p>No users yet</p>
<% end %>
<h3>Recent Visits</h3>
<% if @recent_visits.present? %>
  <ul>
    <% @recent_visits.each do |visit| %>
      <li style="margin-bottom: 8px;">
        IP: <%= visit.ip || "Unknown" %> —
        Country: <%= visit.country.presence || "Unknown" %>,
        Region: <%= visit.region.presence || "Unknown" %>,
        City: <%= visit.city.presence || "Unknown" %><br>
        <% if visit.user %>
          User: <%= visit.user.email %> —
        <% end %>
        User Agent: <%= visit.user_agent || "Unknown" %> —
        Visited At: <%= visit.started_at&.in_time_zone("Asia/Tokyo")&.strftime("%Y-%m-%d %H:%M:%S") || "Unknown" %>
      </li>
    <% end %>
  </ul>
<% else %>
  <p>No recent visits yet</p>
<% end %>
